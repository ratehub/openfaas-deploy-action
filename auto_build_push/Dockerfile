FROM openfaas/faas-cli:0.11.3

ARG DOCKER_USERNAME
ARG DOCKER_PASSWORD
ARG DOCKER_REGISTRY_URL=""
ARG DOCKER_USERNAME_2=""
ARG DOCKER_PASSWORD_2=""
ARG DOCKER_REGISTRY_URL_2=""
ARG CUSTOM_TEMPLATE_URL=""
ARG TAG_OVERRIDE
ARG BUILD_ARG_1_NAME
ARG BUILD_ARG_1_VALUE
ARG BUILD_ARG_2_NAME
ARG BUILD_ARG_2_VALUE
ARG BUILD_ARG_3_NAME
ARG BUILD_ARG_3_VALUE
ARG BUILD_ARG_4_NAME
ARG BUILD_ARG_4_VALUE
ARG BUILD_ARG_5_NAME
ARG BUILD_ARG_5_VALUE
ARG BUILD_ARG_6_NAME
ARG BUILD_ARG_6_VALUE


ENV DOCKER_USERNAME=${DOCKER_USERNAME}
ENV DOCKER_PASSWORD=${DOCKER_PASSWORD}
ENV DOCKER_REGISTRY=${DOCKER_REGISTRY_URL}
ENV DOCKER_USERNAME=${DOCKER_USERNAME_2}
ENV DOCKER_PASSWORD=${DOCKER_PASSWORD_2}
ENV DOCKER_REGISTRY=${DOCKER_REGISTRY_URL_2}
ENV CUSTOM_TEMPLATE_URL=${CUSTOM_TEMPLATE_URL}
ENV TAG_OVERRIDE=${TAG_OVERRIDE}
ENV BUILD_ARG_1_NAME=${BUILD_ARG_1_NAME}
ENV BUILD_ARG_1_VALUE=${BUILD_ARG_1_VALUE}
ENV BUILD_ARG_2_NAME=${BUILD_ARG_2_NAME}
ENV BUILD_ARG_2_VALUE=${BUILD_ARG_2_VALUE}
ENV BUILD_ARG_3_NAME=${BUILD_ARG_3_NAME}
ENV BUILD_ARG_3_VALUE=${BUILD_ARG_3_VALUE}
ENV BUILD_ARG_4_NAME=${BUILD_ARG_4_NAME}
ENV BUILD_ARG_4_VALUE=${BUILD_ARG_4_VALUE}
ENV BUILD_ARG_5_NAME=${BUILD_ARG_5_NAME}
ENV BUILD_ARG_5_VALUE=${BUILD_ARG_5_VALUE}
ENV BUILD_ARG_6_NAME=${BUILD_ARG_6_NAME}
ENV BUILD_ARG_6_VALUE=${BUILD_ARG_6_VALUE}


RUN apk add docker
RUN apk add bash
RUN apk add curl
RUN apk update

RUN wget $(wget -q -O - https://api.github.com/repos/mikefarah/yq/releases | grep browser_download_url | grep 3.2.1 | grep linux_amd64 | cut -d '"' -f 4) -O /usr/bin/yq
RUN chmod +x /usr/bin/yq


# Copies your code file from your action repository to the filesystem path `/` of the container
COPY auto_build_push.sh /auto_build_push.sh

RUN chmod +x /auto_build_push.sh

# Code file to execute when the docker container starts up (`entrypoint.sh`)
ENTRYPOINT ["/auto_build_push.sh"]
